<project name="PentahoMetaData" default="default" basedir=".">

	  <description>
	      Pentaho Metadata build file.
	    </description>

	  <tstamp prefix="start"/>

	  <!-- system properties to use -->
	  <property name="cr" value="${line.separator}"/> 
	  <property name="version" value="0.7.2"/>      
		
	  <!-- set global properties for this build -->
	
	  <property name="src"        			location="src"/> 
	  <property name="classes"        		location="classes"/> 
	  <property name="bin"    				location="bin"/>
	  <property name="lib"        			location="lib"/>
	  <property name="libext"     			location="libext"/>
	  <property name="libswt"     			location="libswt"/>
	  <property name="distrib"				location="distrib"/>
	  <property name="docs"					location="docs"/>
	  <property name="cwm"					location="cwm"/>
	  <property name="jdbc"					location="jdbc"/>
	  <property name="simple-jndi"			location="simple-jndi"/>
	  <property name="api"					location="${docs}/api"/>

	  <property name="sourcezipfile"        location="PentahoMetaData-src-${version}.zip"/>
		  
	  <target name="init" description="create timestamp and directories">
    	<echo>Init...</echo>
	  	
	    <tstamp/>
	    <mkdir dir="${classes}"/>
	    <mkdir dir="${lib}"/>
		<mkdir dir="${distrib}"/>
		<mkdir dir="${docs}"/>
		<mkdir dir="${api}"/>
	  </target>

	  <!--
	       ==========================
	            Compile the code
	       ==========================
	  -->

	  <target name="compile" depends="init" description="compile the source " >
	  	<echo>Compiling Pentaho Metadata...</echo>
	    <javac srcdir="${src}" 
	    	   destdir="${classes}"
	    	   target="1.4"
	    	   source="1.4"
	           deprecation="true"
	    	   debug="true"
	    	>

	    	<classpath id="cp-meta">
				<fileset dir="${libext}" 		includes="**/*.jar"/>
				<fileset dir="${libswt}" 		includes="*.jar"/>
				<fileset dir="${libswt}/win32/" includes="*.jar"/>
		  		</classpath>
	    </javac>
	  	
	  </target>
	
	  <!--
	       ==========================
	          Copy additional files
	       ==========================
	  -->

	  <target name="copy" depends="compile" description="copy images etc to classes directory" >
	  	<echo>Copying images etc to classes directory...</echo>
	    <copy todir="${classes}">
	    	<fileset 
	    		dir="${src}" 
	    		includes="**/*.png **/*.xml **/*properties"/>
	  	    </copy>
	  </target>
	
	
	  <!--
	       ==========================
	         javadoc of the source
	       ==========================
	  -->

	  <target name="javadoc" depends="compile" description="compile the javadoc api" >
	  	<echo>Compiling the Pentaho Metadata API javadocs...</echo>
        <javadoc 
        	destdir="${api}" 
        	access="public" 
        	source="1.4" 
        	use="true" 
        	notree="false" 
        	nonavbar="false" 
        	noindex="false" 
        	splitindex="true" 
        	author="true" 
        	version="true" 
        	maxmemory="256M"
        	nodeprecatedlist="false" 
        	nodeprecated="false" 
        	packagenames ="org.pentaho.pms.*" 
        	sourcepath="${src}" 
        	doctitle="Pentaho Metadata API documentation">
            <link href="http://java.sun.com/j2se/1.4.2/docs/api/"/>

        	<classpath refid="cp-meta"/>

        </javadoc>
	  </target>
	
	  <target name="javadoc_zip" depends="javadoc" description="generate a zip file containing the Pentaho Metadata javadoc">
	  	<echo>Generating the Pentaho Metadata javadoc zip file ...</echo>
	  	<jar jarfile="PentahoMetaData-javadoc-${version}.zip" 
	    	 basedir="${api}" 
	    	 includes="**/*"
	  	     excludes="**/Thumbs.db"
	  		/>
	  </target>
	
	
	  <!--
	       ================================
	           Pentaho Metadata library
	       ================================
	  -->
		
	  <target name="meta" depends="compile, copy" description="generate the Pentaho Meta library pentaho-meta.jar">
	  	<echo>Generating the Pentaho Metadata library pentaho-meta.jar ...</echo>
	  	<jar jarfile="${lib}/pentaho-meta.jar" 
	    	 basedir="${classes}" 
	    	 includes="**/*"
	  	     excludes="**/Thumbs.db"
	  		/>

	  </target>
	
	
	<!--
	       ==========================
	        Distribution jar package
	       ==========================
	  -->
	  <target name="distrib" depends="meta" description="copy jar file to distribution directory" >
	  	<echo>Construct the distribution package...</echo>
	  	
	        <!-- root directory -->
	  		<mkdir dir="${distrib}"/>
	  		<copy todir="${distrib}">
	  			<fileset dir="${bin}" includes="**/*" excludes="**/.vpn .project .classpath"/>
	  			</copy>

	  		<!-- base lib -->
	  		<mkdir dir="${distrib}/lib"/>
	  		<copy todir="${distrib}/lib"  file="${lib}/pentaho-meta.jar"/>

	  		<!-- cwm model-->
	  		<mkdir dir="${distrib}/cwm"/>
	  		<copy todir="${distrib}/cwm"  file="${cwm}/PentahoCWM.xml"/>

	  		<!-- jdbc settings-->
	  		<mkdir dir="${distrib}/jdbc"/>
	  		<copy todir="${distrib}/jdbc">
	  			<fileset dir="${jdbc}" includes="*.*" excludes="**/.vpn"/>
	  	        </copy>

  			<!-- jdbc settings-->
  			<mkdir dir="${distrib}/simple-jndi"/>
  			<copy todir="${distrib}/simple-jndi">
  				<fileset dir="${simple-jndi}" includes="*.*" excludes="**/.vpn"/>
  	        		</copy>

  	        <!-- external libs (jdbc etc) -->
	  		<mkdir dir="${distrib}/libext"/>
	  		<copy todir="${distrib}/libext">
	  			<fileset dir="${libext}" includes="**/*.jar **/*.zip" excludes="**/.vpn"/>
	  			</copy>

	        <!-- swt libs (jdbc etc) -->
	  		<mkdir dir="${distrib}/libswt"/>
	  		<copy todir="${distrib}/libswt">
	  			<fileset dir="${libswt}" includes="**/*" excludes="**/.vpn **/sapjco*.dll"/>
	  			</copy>

	        <!-- documentation -->
	  		<mkdir dir="${distrib}/docs"/>
	  		<copy todir="${distrib}/docs">
	  			<fileset dir="${docs}" 
	  				     includes="**/*.pdf **/*.htm **/*.html **/*.png **/*.PNG **/*.swf **/cn_ZN.zip"
	  			         excludes="**/*.dot **/*.doc **/*.sxw **/*.odt **/*.vpn **/*feature list*" />
	  			</copy>

	  </target>

	  <!--
	       ==========================
	             zipfile
	       ==========================
	  -->
		
	  <target name="zip" depends="distrib" description="generate the PentahoMetaData-${version}.zip file">
	  	<echo>Generating the Pentaho Metadata distribution package PentahoMetaData-${version}.zip ...</echo>
	  	<jar jarfile="PentahoMetaData-${version}.zip" 
	    	 basedir="${distrib}" 
	    	 includes="**/*"
	  	     excludes="**/Thumbs.db"
	  		/>
	  </target>

	  <!--
	       ==========================
	             Source zipfile
	       ==========================
	  -->
		
	  <target name="sourcezip" depends="" description="generate the PentahoMetaData-src-${version}.zip file">
	  	<echo>Generating the Pentaho Metadata source packge zip file (PentahoMetaData-src-${version}.zip) ...</echo>
	  	<jar jarfile="PentahoMetaData-src-${version}.zip" 
	  		 basedir="."
	    	 includes="**/*"
	  	     excludes="*.zip ${classes}/**/* ${distrib}/**/* ${lib}/**/*"
	  		/>
	  </target>

	
	<!--
	       ==========================
	              C L E A N
	       ==========================
	  -->

	  <target name="clean" description="clean up generated files">
	    <delete dir="${classes}"/>
	    <delete dir="${lib}"/>
	    <delete dir="${distrib}"/>
	  	<delete dir="${api}"/>

	  	<delete>
	        <fileset dir=".">
			  <include name="*.zip"/>
	    	</fileset>
	  	</delete>
	  </target>

	
	<!--
	       ==========================
	          Default target: all
	       ==========================
	  -->

	<target name="default" depends="distrib" description="default = build all"/>

</project>
